@require 'palettes'

/*
 * Variables
 * ======================================================================== */

stack_storage('__stem__color-scheme-settings', {
        palette: ColorPalettes

        color: {
            black:       ColorPalettes.clrs.black
            white:       ColorPalettes.clrs.white

            blue:        ColorPalettes.material.blue
            green:       ColorPalettes.material.green
            red:         ColorPalettes.material.red
            yellow:      ColorPalettes.material.yellow

            netural:     ColorPalettes.clrs.silver
            primary:     ColorPalettes.material.blue_grey
            accent:      ColorPalettes.material.light_blue
            // secondary:   ColorPalettes.
            // ternary:     ColorPalettes.
            // quarternary: ColorPalettes.

            dtext:       ColorPalettes.clrs.black
            ltext:       ColorPalettes.clrs.white
            highlight:   ColorPalettes.material.yellow
        }

        ratio: {
            secondary: .70
            disabled:  .30
            divider:   .12
            relief:    .05
        }

        factor: {
            darker:  .05
            lighten: .05
        }
    }, default:true)


CS = stack_storage('__stem__color-scheme-settings')


/**
 * Mixins
 * ======================================================================== */

cs-settings(data=false, base=false, fallback=false, dafault=false)
    stack_storage('__stem__color-scheme-settings', data, base, fallback, dafault)
    temp = stack_storage('__stem__color-scheme-settings')

    reassign('CS', temp)

    return temp


cs_color(color, ratio=0, ratio2=0)
    if ratio2
        return cs_color(cs_color(color, ratio), ratio2)

    if is_list(color)
        ratio = color[1]
        color = color[0]

    if !is_color(color)
        color = CS.color[color]

    if is_unit(ratio)
        if ratio == 0
            return rgba(color, 1)
        else
            ratio = (ratio > 0 ? CS.factor.darker : CS.factor.lighten) * to_raw_percent(ratio)

            return darken(color, ratio * 100%)
    else
        $alpha = to_raw_percent(alpha(color)) * CS.ratio[ratio]

        return rgba(color, $alpha)


/**
 * Depenfing on provided background-color makes text color dark or light.
 */
cs_color_fit(dark=CS.color.dtext, light=CS.color.ltext, bg=@background-color)
    dark  = cs_color(dark)
    light = cs_color(light)
    bg    = cs_color(bg)

    if contrast(bg, light).ratio > contrast(bg, dark).ratio
        return light
    else
        return dark



